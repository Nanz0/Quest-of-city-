<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quest of Cities</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    />
  </head>

  <body>
    <div class="cont">
      <div id="signup-div" class="hidden">
        <form id="signupForm">
          <label for="name" class="text-black">Name</label>
          <input type="text" id="name" name="name" required />

          <label for="username" class="text-black">Username</label>
          <input type="text" id="username" name="username" required />

          <label for="password" class="text-black">Password</label>
          <input type="password" id="password" name="password" required />
          <button type="submit">Sign Up</button>
        </form>
        <div id="signupMessage"></div>
      </div>
      <div id="authForm" class="hidden">
        <form id="loginForm">
          <label for="username-log" class="text-black">Username:</label>
          <input type="text" id="username-log" name="username-log" required />

          <label for="password-log" class="text-black">Password:</label>
          <input
            type="password"
            id="password-log"
            name="password-log"
            required
          />

          <div id="errorMessage" class="error-message hidden">
            Invalid username or password
          </div>
          <button type="submit">Login</button>
        </form>
      </div>

      <form id="joinForm" class="hidden">
        <div class="code-div">
          <label for="code" class="text-black">Code:</label>
          <input type="text" id="code" name="code" />
        </div>
        <button type="submit">Join</button>

        <h6 class="hidden">Wait for Players to Join</h6>
      </form>
      <button id="createGame" type="button" class="hidden">Create Game</button>
      <button id="joinGame" type="button" class="hidden">Join Game</button>
      <div id="player-sidebar">
        <h2>Player Name: <span id="player-name">Player 1</span></h2>
        <div class="coin-balance">Coins: <span id="coin-balance"></span></div>
        <div class="special-card-controls">
          <div class="special-cards">Special Cards:</div>
          <button
            type="button"
            class="control-button"
            onclick="changeCoinCount(-2)"
          >
            -
          </button>
          <div id="special-cards">0</div>
          <button
            type="button"
            class="control-button"
            onclick="changeCoinCount(2)"
          >
            +
          </button>
        </div>
      </div>

      <button id="signup-user" type="button">Sign Up</button>
      <button id="login-user" type="button">Log In</button>

      <div id="landmarkSelection" class="hidden">
        <h4>Select 3 Landmarks</h4>
        <form id="landmarkForm">
          <!-- Dynamically populated landmarks will go here -->
          <button type="button" id="landmarkSelectionBtn">Start Game</button>
        </form>
      </div>
    </div>

    <div class="container-fluid hidden">
      <!-- Trivia question modal -->
      <div id="triviaModal" class="trivia-modal">
        <div class="trivia-content">
          <h2>Trivia Question!</h2>
          <p id="triviaQuestion">What is the capital of France?</p>
          <form id="triviaForm">
            <!-- Dynamically filled options -->
          </form>
          <button type="button" id="submitAnswer">Submit Answer</button>
        </div>
      </div>

      <div class="user-info ps-2 pe-2 pt-1">
        <button
          type="button"
          class="btn btn-success"
          onclick="window.open('./leaderboard.html', '_blank');"
        >
          Leaderboard
        </button>

        <span
          class="user-coin badge badge-xl text-warning ms-auto me-2 mt-auto mb-auto"
          >1</span
        >
        <span class="badge badge-xl text-warning me-auto mt-auto mb-auto">
          COINS</span
        >
        <span
          class="user-name badge badge-xl text-white ms-5 me-3 mt-auto mb-auto"
        ></span>
        <span
          class="p1_badge badge badge-xl bg-white text-dark mt-auto mb-auto"
        ></span>
      </div>
      <div id="player-leftbar">
        <div class="special-cards">
          Special Cards: <span id="num-special-cards">0</span>
        </div>
      </div>
      <div id="random-event">
        <div
          class="special-card-controls special-card-controls-1 d-flex flex-column"
        >
          <div id="div-to-disappear">
            <button
              type="button"
              class="special-cards border-0 rounded-2 bg-dark"
            >
              <span id="time-limiter">Avail Time Limiter</span>
            </button>
          </div>
          <div class="div-to-appear d-flex flex-row">
            <button
              type="button"
              class="special-cards me-2 bg-dark text-light border-0 rounded-2"
            >
              Sufi
            </button>
            <button
              type="button"
              class="special-cards bg-dark text-light border-0 rounded-2"
            >
              Sufi
            </button>
          </div>
          <div class="div-to-appear-2 d-flex flex-row">
            <button
              type="button"
              class="special-cards me-2 bg-dark text-light border-0 rounded-2"
            >
              60 Sec
            </button>
            <button
              type="button"
              class="special-cards bg-dark text-light border-0 rounded-2"
            >
              30 Sec
            </button>
          </div>
        </div>
      </div>
      <div id="negotiation-area">
        <span class="negotiate-close">&times;</span>
        <button id="negotiate-btn" type="button">Negotiate</button>
        <!-- Player buttons will be added dynamically -->
      </div>
      <div id="negotiationModal" class="modal">
        <div class="modal-content">
          <span class="close">&times;</span>
          <p id="negotiationMessage"></p>
          <button type="button" id="negotiateYes">Yes</button>
          <button type="button" id="negotiateNo">No</button>
        </div>
      </div>
      <div id="name-tag-div">
        <span>name1</span>
        <span>name2</span>
      </div>
      <div class="card-container"></div>
      <div class="text-center">
        <button type="button" class="btn btn-warning m-3 mt-1 shuffleBtn">
          Shuffle
        </button>
      </div>
      <div class="d-flex justify-content-center match-container">
        <button type="button" class="btn btn-success m-3 mt-1 mb-3 matchBtn">
          I Don't Know
        </button>
      </div>
      <div class="middle-div">
        <div class="user-cards user-1-cards">
          <button
            type="button"
            class="user-clue user-1 fade-in"
            style="transform: rotate(-20deg)"
          ></button>
          <button
            type="button"
            class="user-clue user-1 fade-in"
            style="transform: rotate(20deg)"
          ></button>
          <button
            type="button"
            class="user-clue user-1 fade-in"
            style="transform: rotate(0deg)"
          ></button>
        </div>
        <div class="deck-container">
          <button
            type="button"
            class="clue-card clue-card-text card-pos-a"
          ></button>
          <button
            type="button"
            class="clue-card clue-card-text card-pos-b"
          ></button>
          <button
            type="button"
            class="clue-card clue-card-text card-pos-c"
          ></button>
          <button
            type="button"
            class="clue-card clue-card-text card-pos-d"
          ></button>
          <button
            type="button"
            class="clue-card clue-card-text card-pos-e"
          ></button>
          <button
            type="button"
            class="clue-card clue-card-text card-pos-f"
          ></button>
          <button
            type="button"
            class="clue-card clue-card-text card-pos-a"
          ></button>
          <button
            type="button"
            class="clue-card clue-card-text card-pos-b"
          ></button>
          <button
            type="button"
            class="clue-card clue-card-text card-pos-c"
          ></button>
          <button
            type="button"
            class="clue-card clue-card-text card-pos-d"
          ></button>
          <button
            type="button"
            class="clue-card clue-card-text card-pos-e"
          ></button>
          <button
            type="button"
            class="clue-card clue-card-text card-pos-f"
          ></button>
          <button
            type="button"
            class="clue-card clue-card-text card-pos-a"
          ></button>
        </div>
      </div>
      <div class="player-badge-div d-flex justify-content-between">
        <div>
          <span
            class="player_3 badge badge-xl text-white ms-auto me-3 mt-auto mb-auto"
          ></span>
          <span
            class="p3_badge badge badge-xl bg-white text-dark mt-auto mb-auto"
          ></span>
        </div>
        <div class="player2-badge-div">
          <span
            class="player_2 badge badge-xl text-white ms-auto me-3 mt-auto mb-auto"
          ></span>
          <span
            class="p2_badge badge badge-xl bg-white text-dark mt-auto mb-auto"
          ></span>
        </div>
      </div>
    </div>
    <!-- In your HTML, add a snackbar container -->
    <div id="snackbar"></div>

    <script src="/socket.io/socket.io.js"></script>

    <script src="script1.js"></script>
    <script>
      let playerName;
      document
        .getElementById("loginForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault();
          const email = document.getElementById("username-log").value;
          const password = document.getElementById("password-log").value;

          try {
            const response = await fetch("http://localhost:3000/login", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ email, password }),
            });

            const data = await response.json();
            if (data.status === "success") {
              document.querySelector(".user-name").textContent = data.name;
              document.querySelector("#coin-balance").textContent = data.coins;
              playerName = data.name;
              document.getElementById("login-user").classList.add("hidden");
              document.querySelector("#authForm").classList.add("hidden");
              document.getElementById("createGame").classList.remove("hidden");
              document.getElementById("joinGame").classList.remove("hidden");
            } else {
              document.getElementById("errorMessage").textContent =
                data.message; // Update error message
              document
                .getElementById("errorMessage")
                .classList.remove("hidden");
              document.getElementById("username").classList.add("error-input");
              document.getElementById("password").classList.add("error-input");
            }
          } catch (error) {
            console.error("Login error:", error);
          }
        });
      socket.on("registerPlayer", (e) => {
        let allPlayersArray = e.allPlayers;

        let player1Name;
        let player2Name;
        let player3Name;

        let score1, score2, score3;
        const nameTags = document.querySelectorAll("#name-tag-div>span");

        const foundObj = allPlayersArray.find(
          (obj) =>
            obj.p1.p1_name == `${playerName}` ||
            obj.p2.p2_name == `${playerName}` ||
            obj.p3.p3_name == `${playerName}`
        );

        if (foundObj.p1.p1_name == `${playerName}`) {
          player1Name = foundObj.p1.p1_name;
          player2Name = foundObj.p2.p2_name;
          player3Name = foundObj.p3.p3_name;
        } else if (foundObj.p2.p2_name == `${playerName}`) {
          player1Name = foundObj.p2.p2_name;
          player2Name = foundObj.p1.p1_name;
          player3Name = foundObj.p3.p3_name;
        } else {
          player1Name = foundObj.p3.p3_name;
          player2Name = foundObj.p1.p1_name;
          player3Name = foundObj.p2.p2_name;
        }

        if (foundObj.p1.p1_name == `${playerName}`) {
          score1 = foundObj.p1.p1_score;
          score2 = foundObj.p2.p2_score;
          score3 = foundObj.p3.p3_score;
          nameTags[0].textContent = player2Name;
          nameTags[1].textContent = player3Name;
        } else if (foundObj.p2.p2_name == `${playerName}`) {
          score1 = foundObj.p2.p2_score;
          score2 = foundObj.p1.p1_score;
          score3 = foundObj.p3.p3_score;
          nameTags[0].textContent = player2Name;
          nameTags[1].textContent = player3Name;
        } else {
          score1 = foundObj.p3.p3_score;
          score2 = foundObj.p1.p1_score;
          score3 = foundObj.p2.p2_score;
          nameTags[0].textContent = player2Name;
          nameTags[1].textContent = player3Name;
        }
        document.querySelector(".p1_badge").textContent = score1;

        document.querySelector(".player_2").innerText = player2Name;
        document.querySelector(".p2_badge").textContent = score2;

        document.querySelector(".player_3").innerText = player3Name;
        document.querySelector(".p3_badge").textContent = score3;
      });
    </script>
  </body>
</html>
